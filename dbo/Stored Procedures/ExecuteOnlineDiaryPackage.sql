CREATE PROCEDURE ExecuteOnlineDiaryPackage @PackageName NVARCHAR(100),  @PackageServer NVARCHAR(100), @SingleFileName NVARCHAR(100), @SQLUserName NVARCHAR(100), @SQLPassword NVARCHAR(100), @PanelID INT,@ImportType INT=2,@ConnectionID INT=1, @DTexePath NVARCHAR(500)=N'c: & cd\ & cd "C:\Program Files (x86)\Microsoft SQL Server\110\DTS\Binn\"', @LogFilePath NVARCHAR(500)=N'E:\OFFSHORE\OnlineDiaries\DTEXECLogging.txt' AS  BEGIN  DECLARE @command NVARCHAR(MAX);  DECLARE @ReturnCode INT ; DECLARE @Msg NVARCHAR(1000); DECLARE @TB as TABLE (Result NVARCHAR(MAX)); SET @command= N'/SQL "\"\'+@PackageName+'\"" /SERVER "\"'+@PackageServer+'\"" /CHECKPOINTING OFF /REPORTING N'; SET @command=@command+ ' /SET \Package.Variables[User::ImportType].Properties[Value];' + convert(nvarchar,@ImportType); SET @command=@command+ ' /SET \Package.Variables[User::SingleFileName].Properties[Value];' + @SingleFileName; SET @command=@command+ ' /SET \Package.Variables[User::SQLUserName].Properties[Value];' + @SQLUserName; SET @command=@command+ ' /SET \Package.Variables[User::SQLPassword].Properties[Value];' + @SQLPassword; SET @command=@command+ ' /SET \Package.Variables[User::PanelID].Properties[Value];' + convert(nvarchar,@PanelID); SET @command=@command+ ' /SET \Package.Variables[User::ConnectionID].Properties[Value];' + convert(nvarchar,@ConnectionID); SET @Msg=@DTexePath+' & DTexec.exe '+@command; INSERT INTO @TB EXEC xp_cmdshell @Msg; SELECT Result FROM @TB; END